C51 COMPILER V9.57.0.0   WENDU                                                             05/25/2022 22:45:33 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE WENDU
OBJECT MODULE PLACED IN wendu.obj
COMPILER INVOKED BY: E:\keil\C51\BIN\C51.EXE app\wendu.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\wendu.lst) 
                    -TABS(2) OBJECT(wendu.obj)

line level    source

   1          /*
   2           * @LastEditors: Dark white
   3           * @LastEditTime: 2022-05-25 22:41:02
   4           * @FilePath: \51\51-car-mabiao\app\wendu.c
   5           * @Description: based on ds18b20
   6           *
   7           * Copyright (c) 2022 by Dark white, All Rights Reserved.
   8           */
   9          #include "wendu.h"
  10          #include "../driver/uart.h"
  11          #include <intrins.h>
  12          sbit DQ = P3 ^ 7; //å®šä¹‰æ•°æ®çº¿
  13          uint8 temperature = 0;
  14          /*************ç²¾ç¡®å»¶æ—¶å‡½æ•°*****************/
  15          void delay(unsigned char i) {
  16   1        do {
  17   2          _nop_();
  18   2          _nop_();
  19   2          _nop_();
  20   2          i--;
  21   2        } while (i);
  22   1      }
  23          
  24          /*****************DS18B20******************/
  25          void Init_Ds18b20(void) // DS18B20åˆå§‹åŒ–send reset and initialization command
  26          {
  27   1        DQ = 1;     // DQå¤ä½,ä¸è¦ä¹Ÿå¯è¡Œã€‚
  28   1        delay(1);   //ç¨åšå»¶æ—¶
  29   1        DQ = 0;     //å•ç‰‡æœºæ‹‰ä½æ€»çº¿
  30   1        delay(120); // 51-120ç²¾ç¡®å»¶æ—¶ï¼Œç»´æŒè‡³å°‘480us
  31   1        // delay(100);
  32   1        DQ = 1;
  33   1        delay(100); //é‡Šæ”¾æ€»çº¿ï¼Œå³æ‹‰é«˜äº†æ€»çº¿
  34   1        // while(~DQ); //51-100æ­¤å¤„å»¶æ—¶æœ‰è¶³å¤Ÿ,ç¡®ä¿èƒ½è®©DS18B20å‘å‡ºå­˜åœ¨è„‰å†²ã€‚
  35   1      }
  36          uint8 Read_One_Byte() //è¯»å–ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®read a byte date
  37                                //è¯»æ•°æ®æ—¶,æ•°æ®ä»¥å­—èŠ‚çš„æœ€ä½æœ‰æ•ˆä½å…ˆä»æ€»çº¿ç§»å‡º
  38          {
  39   1        uint8 i = 0;
  40   1        uint8 dat = 0;
  41   1        for (i = 8; i > 0; i--) {
  42   2          DQ = 0;  //å°†æ€»çº¿æ‹‰ä½ï¼Œè¦åœ¨1usä¹‹åé‡Šæ”¾æ€»çº¿
  43   2                   //å•ç‰‡æœºè¦åœ¨æ­¤ä¸‹é™æ²¿åçš„15uså†…è¯»æ•°æ®æ‰ä¼šæœ‰æ•ˆã€‚
  44   2          _nop_(); //è‡³å°‘ç»´æŒäº†1us,è¡¨ç¤ºè¯»æ—¶åºå¼€å§‹
  45   2          dat >>= 1; //è®©ä»æ€»çº¿ä¸Šè¯»åˆ°çš„ä½æ•°æ®ï¼Œä¾æ¬¡ä»é«˜ä½ç§»åŠ¨åˆ°ä½ä½ã€‚
  46   2          DQ = 1; //é‡Šæ”¾æ€»çº¿ï¼Œæ­¤åDS18B20ä¼šæ§åˆ¶æ€»çº¿,æŠŠæ•°æ®ä¼ è¾“åˆ°æ€»çº¿ä¸Š
  47   2          delay(
  48   2              1); // 51-1
  49   2                  // //å»¶æ—¶7us,æ­¤å¤„å‚ç…§æ¨èçš„è¯»æ—¶åºå›¾ï¼Œå°½é‡æŠŠæ§åˆ¶å™¨é‡‡æ ·æ—¶é—´æ”¾åˆ°è¯»æ—¶å
             -ºåçš„15uså†…çš„æœ€åéƒ¨åˆ†
  50   2          if (DQ) //æ§åˆ¶å™¨è¿›è¡Œé‡‡æ ·
  51   2          {
  52   3            dat |=
  53   3                0x80; //è‹¥æ€»çº¿ä¸º1,å³DQä¸º1,é‚£å°±æŠŠdatçš„æœ€é«˜ä½ç½®1;è‹¥ä¸º0,åˆ™ä¸è¿›è¡Œå¤„ç†,ä¿æŒä¸
C51 COMPILER V9.57.0.0   WENDU                                                             05/25/2022 22:45:33 PAGE 2   

             -º0
  54   3          }
  55   2          delay(10); // 51-10     //æ­¤å»¶æ—¶ä¸èƒ½å°‘ï¼Œç¡®ä¿è¯»æ—¶åºçš„é•¿åº¦60usã€‚
  56   2        }
  57   1        return (dat);
  58   1      }
  59          void Write_One_Byte(uint8 dat) {
  60   1        uint8 i = 0;
  61   1        for (i = 8; i > 0; i--) {
  62   2          DQ = 0; //æ‹‰ä½æ€»çº¿
  63   2          _nop_(); //è‡³å°‘ç»´æŒäº†1us,è¡¨ç¤ºå†™æ—¶åº(åŒ…æ‹¬å†™0æ—¶åºæˆ–å†™1æ—¶åº)å¼€å§‹
  64   2          DQ = dat & 0x01; //ä»å­—èŠ‚çš„æœ€ä½ä½å¼€å§‹ä¼ è¾“
  65   2                           //æŒ‡ä»¤datçš„æœ€ä½ä½èµ‹äºˆç»™æ€»çº¿,å¿…é¡»åœ¨æ‹‰ä½æ€»çº¿åçš„15uså†…,
  66   2                           //å› ä¸º15usåDS18B20ä¼šå¯¹æ€»çº¿é‡‡æ ·ã€‚
  67   2          delay(11); // 51-10         //å¿…é¡»è®©å†™æ—¶åºæŒç»­è‡³å°‘60us
  68   2          DQ = 1;    //å†™å®Œå,å¿…é¡»é‡Šæ”¾æ€»çº¿,
  69   2          dat >>= 1;
  70   2          delay(1); // 51-1
  71   2        }
  72   1      }
  73          
  74          void Get_Tmp() //è·å–æ¸©åº¦get the temperature
  75          {
  76   1        float tt;
  77   1        uint8 a, b;
  78   1        uint16 temp;
  79   1        Init_Ds18b20();       //åˆå§‹åŒ–
  80   1        Write_One_Byte(0xcc); //å¿½ç•¥ROMæŒ‡ä»¤
  81   1        Write_One_Byte(0x44); //æ¸©åº¦è½¬æ¢æŒ‡ä»¤
  82   1        Init_Ds18b20();       //åˆå§‹åŒ–
  83   1        Write_One_Byte(0xcc); //å¿½ç•¥ROMæŒ‡ä»¤
  84   1        Write_One_Byte(0xbe); //è¯»æš‚å­˜å™¨æŒ‡ä»¤
  85   1        a = Read_One_Byte();  //è¯»å–åˆ°çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸ºæ¸©åº¦LSB
  86   1        b = Read_One_Byte();  //è¯»å–åˆ°çš„ç¬¬äºŒä¸ªå­—èŠ‚ä¸ºæ¸©åº¦MSB
  87   1        temp = b;             //å…ˆæŠŠé«˜å…«ä½æœ‰æ•ˆæ•°æ®èµ‹äºtemp
  88   1        temp <<= 8;           //æŠŠä»¥ä¸Š8ä½æ•°æ®ä»tempä½å…«ä½ç§»åˆ°é«˜å…«ä½
  89   1        temp = temp | a;      //ä¸¤å­—èŠ‚åˆæˆä¸€ä¸ªæ•´å‹å˜é‡
  90   1        if (b > 0x80) {
  91   2          temp = (~temp) + 1;
  92   2        } 
  93   1        tt = temp * 0.0625; //å¾—åˆ°çœŸå®åè¿›åˆ¶æ¸©åº¦å€¼ //å› ä¸ºDS18B20å¯ä»¥ç²¾ç¡®åˆ°0.0625åº¦
  94   1                            ////æ‰€ä»¥è¯»å›æ•°æ®çš„æœ€ä½ä½ä»£è¡¨çš„æ˜¯0.0625åº¦
  95   1        temperature=tt;
  96   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    176    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
